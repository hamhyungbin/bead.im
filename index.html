<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Bead.im</title>
    <style>
        :root {
            --card-width: 80px;
            --card-height: 110px;
            --card-border-radius: 6px;
            --background-color: #0d4b29;
            --font-color: #ffffff;
            --table-color: #0f6c3a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--background-color);
            color: var(--font-color);
            text-align: center;
            padding: 20px;
        }

        h1 {
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        h2 {
            font-size: 1.2em;
            margin: 10px 0;
            min-height: 1.2em; /* ê³µê°„ ìœ ì§€ */
        }

        .game-table {
            background-color: var(--table-color);
            border-radius: 20px;
            padding: 20px;
            margin: 0 auto;
            max-width: 800px;
            border: 5px solid #a47a4a;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }

        .hand {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            min-height: var(--card-height);
        }

        .card {
            width: var(--card-width);
            height: var(--card-height);
            border: 2px solid #ccc;
            border-radius: var(--card-border-radius);
            background-color: white;
            color: black;
            font-size: 2.5em;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 3px 3px 7px rgba(0,0,0,0.3);
            position: relative;
        }

        .card .rank {
             position: absolute;
             top: 5px;
             left: 8px;
             font-size: 0.5em;
        }
        .card .suit {
            font-size: 1em;
        }

        .card.heart, .card.diamond { color: #ff0000; }
        .card.spade, .card.club { color: #000000; }

        .card.back {
            background-color: #b02a2a;
            background-image: repeating-linear-gradient(45deg, #c0392b, #c0392b 10px, #b02a2a 10px, #b02a2a 20px);
        }
        
        .card.back .suit, .card.back .rank {
            display: none;
        }

        #community-cards .card {
            border-color: #ffd700;
        }

        .actions {
            margin-top: 20px;
        }

        button {
            padding: 12px 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: #e67e22;
            color: white;
            transition: background-color 0.3s, transform 0.1s;
            margin: 0 10px;
        }

        button:hover {
            background-color: #d35400;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        #game-status {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 15px;
            min-height: 1.5em; /* ê³µê°„ ìœ ì§€ */
            color: #f1c40f;
        }
    </style>
</head>
<body>

    <h1>â™ ï¸ í…ì‚¬ìŠ¤ í™€ë¤ â™¦ï¸</h1>
    <div class="game-table">
        <h2>ì»´í“¨í„° <span id="computer-hand-rank"></span></h2>
        <div id="computer-hand" class="hand"></div>

        <h2>ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ</h2>
        <div id="community-cards" class="hand"></div>

        <h2>í”Œë ˆì´ì–´ <span id="player-hand-rank"></span></h2>
        <div id="player-hand" class="hand"></div>
        
        <div id="game-status">ìƒˆ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!</div>
        
        <div class="actions">
            <button id="new-game-btn">ìƒˆ ê²Œì„</button>
            <button id="next-step-btn" disabled>ë‹¤ìŒ</button>
        </div>
    </div>

    <script>
        // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const playerHandDiv = document.getElementById('player-hand');
        const computerHandDiv = document.getElementById('computer-hand');
        const communityCardsDiv = document.getElementById('community-cards');
        const playerHandRankSpan = document.getElementById('player-hand-rank');
        const computerHandRankSpan = document.getElementById('computer-hand-rank');
        const gameStatusDiv = document.getElementById('game-status');
        const newGameBtn = document.getElementById('new-game-btn');
        const nextStepBtn = document.getElementById('next-step-btn');

        // ì¹´ë“œ ì •ì˜
        const SUITS = ['â™ ', 'â™£', 'â™¥', 'â™¦'];
        const RANKS = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        const RANK_VALUES = { 'A': 14, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13 };

        // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
        let deck = [];
        let playerHand = [];
        let computerHand = [];
        let communityCards = [];
        let gameState = 'idle'; // idle, pre-flop, flop, turn, river, showdown

        //--- ê²Œì„ ë¡œì§ í•¨ìˆ˜ ---//

        // ë± ìƒì„±
        function createDeck() {
            deck = [];
            for (const suit of SUITS) {
                for (const rank of RANKS) {
                    deck.push({ suit, rank, value: RANK_VALUES[rank] });
                }
            }
        }

        // ë± ì„ê¸° (í”¼ì…”-ì˜ˆì´ì¸  ì•Œê³ ë¦¬ì¦˜)
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }
        
        // ì¹´ë“œ ë Œë”ë§
        function renderCard(card, container, faceUp = true) {
            const cardDiv = document.createElement('div');
            cardDiv.classList.add('card');
            
            const rankDiv = document.createElement('div');
            rankDiv.classList.add('rank');
            rankDiv.textContent = card.rank;

            const suitDiv = document.createElement('div');
            suitDiv.classList.add('suit');
            suitDiv.textContent = card.suit;

            if (card.suit === 'â™¥') cardDiv.classList.add('heart');
            if (card.suit === 'â™¦') cardDiv.classList.add('diamond');
            if (card.suit === 'â™ ') cardDiv.classList.add('spade');
            if (card.suit === 'â™£') cardDiv.classList.add('club');

            if (!faceUp) {
                cardDiv.classList.add('back');
            }
            
            cardDiv.appendChild(rankDiv);
            cardDiv.appendChild(suitDiv);
            container.appendChild(cardDiv);
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updateBoard() {
            playerHandDiv.innerHTML = '';
            computerHandDiv.innerHTML = '';
            communityCardsDiv.innerHTML = '';
            
            playerHand.forEach(card => renderCard(card, playerHandDiv));
            
            computerHand.forEach((card, index) => {
                renderCard(card, computerHandDiv, gameState === 'showdown');
            });
            
            communityCards.forEach(card => renderCard(card, communityCardsDiv));
        }

        // ìƒˆ ê²Œì„ ì‹œì‘
        function newGame() {
            gameState = 'pre-flop';
            createDeck();
            shuffleDeck();

            playerHand = [deck.pop(), deck.pop()];
            computerHand = [deck.pop(), deck.pop()];
            communityCards = [];
            
            playerHandRankSpan.textContent = '';
            computerHandRankSpan.textContent = '';
            gameStatusDiv.textContent = "í”Œëì„ ë³´ì‹œê² ìŠµë‹ˆê¹Œ?";

            updateBoard();

            nextStepBtn.disabled = false;
            newGameBtn.textContent = 'ìƒˆ ê²Œì„';
        }

        // ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
        function nextStep() {
            if (gameState === 'pre-flop') { // í”Œë (ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 3ì¥)
                gameState = 'flop';
                communityCards.push(deck.pop(), deck.pop(), deck.pop());
                gameStatusDiv.textContent = "í„´ì„ ë³´ì‹œê² ìŠµë‹ˆê¹Œ?";
            } else if (gameState === 'flop') { // í„´ (ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 1ì¥)
                gameState = 'turn';
                communityCards.push(deck.pop());
                gameStatusDiv.textContent = "ë¦¬ë²„ë¥¼ ë³´ì‹œê² ìŠµë‹ˆê¹Œ?";
            } else if (gameState === 'turn') { // ë¦¬ë²„ (ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ 1ì¥)
                gameState = 'river';
                communityCards.push(deck.pop());
                gameStatusDiv.textContent = "ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”!";
            } else if (gameState === 'river') { // ì‡¼ë‹¤ìš´ (ê²°ê³¼ ë°œí‘œ)
                gameState = 'showdown';
                nextStepBtn.disabled = true;

                const playerFullHand = playerHand.concat(communityCards);
                const computerFullHand = computerHand.concat(communityCards);

                const playerBestHand = evaluateHand(playerFullHand);
                const computerBestHand = evaluateHand(computerFullHand);

                playerHandRankSpan.textContent = `(${playerBestHand.name})`;
                computerHandRankSpan.textContent = `(${computerBestHand.name})`;
                
                if (playerBestHand.score > computerBestHand.score) {
                    gameStatusDiv.textContent = "ğŸ‰ í”Œë ˆì´ì–´ ìŠ¹ë¦¬! ğŸ‰";
                } else if (computerBestHand.score > playerBestHand.score) {
                    gameStatusDiv.textContent = "ì»´í“¨í„° ìŠ¹ë¦¬!";
                } else {
                    gameStatusDiv.textContent = "ë¬´ìŠ¹ë¶€!";
                }
            }
            updateBoard();
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        newGameBtn.addEventListener('click', newGame);
        nextStepBtn.addEventListener('click', nextStep);

        //--- íŒ¨ ìˆœìœ„ íŒì • ë¡œì§ ---//

        function evaluateHand(sevenCards) {
            const allCombinations = getCombinations(sevenCards, 5);
            let bestHand = { name: 'í•˜ì´ ì¹´ë“œ', score: 0 };

            for (const combo of allCombinations) {
                const currentHand = checkHand(combo);
                if (currentHand.score > bestHand.score) {
                    bestHand = currentHand;
                }
            }
            return bestHand;
        }

        function checkHand(fiveCards) {
            fiveCards.sort((a, b) => b.value - a.value);
            const values = fiveCards.map(c => c.value);
            const ranks = fiveCards.map(c => c.rank);
            const suits = fiveCards.map(c => c.suit);

            const isFlush = new Set(suits).size === 1;
            const uniqueValues = [...new Set(values)];
            const isStraight = uniqueValues.length === 5 && (uniqueValues[0] - uniqueValues[4] === 4);
            const isAceLowStraight = JSON.stringify(uniqueValues.sort((a, b) => a - b)) === JSON.stringify([2, 3, 4, 5, 14]);

            // ë­í¬ë³„ ì¹´ë“œ ê°œìˆ˜ ì„¸ê¸°
            const rankCounts = ranks.reduce((acc, rank) => {
                acc[rank] = (acc[rank] || 0) + 1;
                return acc;
            }, {});
            const counts = Object.values(rankCounts).sort((a, b) => b - a);
            const primaryScore = values.reduce((acc, val, i) => acc + val * Math.pow(15, 4 - i), 0);
            
            // 1. ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ (ë¡œì—´ í”ŒëŸ¬ì‹œ í¬í•¨)
            if (isStraight && isFlush) {
                if(values[0] === 14) return { name: 'ë¡œì—´ í”ŒëŸ¬ì‹œ', score: 9000000000000 + primaryScore };
                return { name: 'ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ', score: 8000000000000 + primaryScore };
            }
            // ì—ì´ìŠ¤-ë¡œìš° ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ
             if (isAceLowStraight && isFlush) {
                return { name: 'ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ (A-5)', score: 8000000000000 + 50000000000 };
            }

            // 2. í¬ì¹´ë“œ
            if (counts[0] === 4) {
                return { name: 'í¬ì¹´ë“œ', score: 7000000000000 + primaryScore };
            }

            // 3. í’€í•˜ìš°ìŠ¤
            if (counts[0] === 3 && counts[1] === 2) {
                return { name: 'í’€í•˜ìš°ìŠ¤', score: 6000000000000 + primaryScore };
            }

            // 4. í”ŒëŸ¬ì‹œ
            if (isFlush) {
                return { name: 'í”ŒëŸ¬ì‹œ', score: 5000000000000 + primaryScore };
            }

            // 5. ìŠ¤íŠ¸ë ˆì´íŠ¸
            if (isStraight) {
                return { name: 'ìŠ¤íŠ¸ë ˆì´íŠ¸', score: 4000000000000 + primaryScore };
            }
             if (isAceLowStraight) {
                return { name: 'ìŠ¤íŠ¸ë ˆì´íŠ¸ (A-5)', score: 4000000000000 + 50000000000 };
            }

            // 6. íŠ¸ë¦¬í”Œ (ì“°ë¦¬ ì˜¤ë¸Œ ì–´ ì¹´ì¸ë“œ)
            if (counts[0] === 3) {
                return { name: 'íŠ¸ë¦¬í”Œ', score: 3000000000000 + primaryScore };
            }

            // 7. íˆ¬ í˜ì–´
            if (counts[0] === 2 && counts[1] === 2) {
                return { name: 'íˆ¬ í˜ì–´', score: 2000000000000 + primaryScore };
            }

            // 8. ì› í˜ì–´
            if (counts[0] === 2) {
                return { name: 'ì› í˜ì–´', score: 1000000000000 + primaryScore };
            }

            // 9. í•˜ì´ ì¹´ë“œ
            return { name: 'í•˜ì´ ì¹´ë“œ', score: primaryScore };
        }

        // ì¡°í•©(Combination) ìƒì„± í•¨ìˆ˜
        function getCombinations(array, size) {
            const result = [];
            function combination(startIndex, currentCombo) {
                if (currentCombo.length === size) {
                    result.push([...currentCombo]);
                    return;
                }
                for (let i = startIndex; i < array.length; i++) {
                    currentCombo.push(array[i]);
                    combination(i + 1, currentCombo);
                    currentCombo.pop();
                }
            }
            combination(0, []);
            return result;
        }
    </script>
</body>
</html>
